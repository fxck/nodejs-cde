zerops:
  - setup: api
    build:
      base: nodejs@20
      buildCommands:
        - npm i
        - npm run build
      deployFiles:
        - ./dist
        - ./node_modules
        - ./package.json
    run:
      base: nodejs@20
      ports:
        - port: 3000
          httpSupport: true
      envVariables:
        NODE_ENV: production
        DB_NAME: db
        DB_HOST: db
        DB_USER: db
        DB_PASS: ${db_password}
      start: npm run start:prod
      healthCheck:
        httpGet:
          port: 3000
          path: /status

  - setup: cdebase
    build:
      base: nodejs@20
      os: ubuntu
      buildCommands:
        - npm i
      deployFiles:
        - ./
      cache:
        - node_modules
    run:
      base: nodejs@20
      os: ubuntu
      prepareCommands:
        - curl -L -o download-vs-code-server.sh https://raw.githubusercontent.com/b01/dl-vscode-server/main/download-vs-code-server.sh
        - chmod +x download-vs-code-server.sh
        - ./download-vs-code-server.sh "linux" "x64"
      ports:
        - port: 3000
          httpSupport: true
      envVariables:
        NODE_ENV: production
        BUILD: stable
        DB_NAME: db
        DB_HOST: db
        DB_USER: db
        DB_PASS: ${db_password}
      start: zsc noop --silent

  - setup: ales
    extends: cdebase
